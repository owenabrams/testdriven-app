# User Activity Calendar & Gender Integration Flow\n\n## 🎯 **Complete Activity Tracking System**\n\n**Date**: December 8, 2024  \n**Status**: 📋 **INTEGRATION SPECIFICATION**  \n**Flow**: User Activities → Calendar Events → Gender Analytics\n\n---\n\n## 🔄 **Activity-to-Calendar Flow**\n\n### **When Users Perform Activities**\n\n#### **1. User Records Savings**\n```javascript\n// Frontend: User clicks \"Record Savings\"\n// Sarah (Female, Chair) records UGX 50,000 personal savings\n\nconst savingData = {\n  amount: 50000,\n  saving_type: 'PERSONAL',\n  payment_method: 'MTN Mobile Money'\n};\n\n// API Call: POST /api/savings-groups/savings/record/\n```\n\n#### **2. Backend Processing**\n```python\n# Backend automatically captures user context\n@authenticate\ndef record_saving():\n    current_user = get_current_user()  # Sarah's user account\n    member = GroupMember.query.filter_by(user_id=current_user.id).first()\n    \n    # Create transaction record\n    transaction = SavingTransaction(\n        member_id=member.id,\n        amount=request.json['amount'],\n        transaction_date=datetime.now()\n    )\n    \n    # Automatically create calendar event\n    calendar_event = CalendarEvent(\n        id=f\"transaction_{transaction.id}\",\n        event_type='TRANSACTION',\n        event_subtype='savings_deposit',\n        date=transaction.transaction_date.date(),\n        time=transaction.transaction_date.time(),\n        title=f\"{member.name} - Personal Savings\",\n        group_id=member.group_id,\n        user_id=member.user_id,\n        event_data={\n            'amount': float(transaction.amount),\n            'currency': 'UGX',\n            'payment_method': request.json['payment_method'],\n            'member_gender': member.gender,  # 'F' for Sarah\n            'member_role': member.role       # 'CHAIR'\n        },\n        status='completed'\n    )\n    \n    db.session.add_all([transaction, calendar_event])\n    db.session.commit()\n```\n\n#### **3. Calendar Display**\n```javascript\n// Calendar automatically shows the event\n{\n  \"id\": \"transaction_123\",\n  \"type\": \"TRANSACTION\",\n  \"date\": \"2024-12-08\",\n  \"time\": \"14:30:00\",\n  \"title\": \"Sarah Nakato - Personal Savings\",\n  \"amount\": 50000,\n  \"member\": {\n    \"name\": \"Sarah Nakato\",\n    \"gender\": \"F\",\n    \"role\": \"CHAIR\"\n  },\n  \"icon\": \"💰\",\n  \"color\": \"#4CAF50\"\n}\n```\n\n---\n\n## 🎨 **Calendar with Gender Filtering**\n\n### **Filter Options**\n```javascript\n// Calendar Filter Component\nconst CalendarFilters = () => {\n  const [filters, setFilters] = useState({\n    dateRange: { start: '2024-12-01', end: '2024-12-31' },\n    eventTypes: ['TRANSACTION', 'MEETING', 'LOAN'],\n    gender: 'ALL', // 'ALL', 'F', 'M'\n    members: [],   // Specific member IDs\n    groups: []     // Specific group IDs\n  });\n\n  return (\n    <Box>\n      {/* Date Range Picker */}\n      <DateRangePicker \n        value={filters.dateRange}\n        onChange={(range) => setFilters({...filters, dateRange: range})}\n      />\n      \n      {/* Gender Filter */}\n      <FormControl>\n        <InputLabel>Gender</InputLabel>\n        <Select value={filters.gender} onChange={handleGenderChange}>\n          <MenuItem value=\"ALL\">All Genders</MenuItem>\n          <MenuItem value=\"F\">Women Only</MenuItem>\n          <MenuItem value=\"M\">Men Only</MenuItem>\n        </Select>\n      </FormControl>\n      \n      {/* Event Type Filter */}\n      <FormControl>\n        <InputLabel>Activity Types</InputLabel>\n        <Select multiple value={filters.eventTypes}>\n          <MenuItem value=\"TRANSACTION\">💰 Transactions</MenuItem>\n          <MenuItem value=\"MEETING\">👥 Meetings</MenuItem>\n          <MenuItem value=\"LOAN\">🏦 Loans</MenuItem>\n          <MenuItem value=\"CAMPAIGN\">🎯 Campaigns</MenuItem>\n        </Select>\n      </FormControl>\n    </Box>\n  );\n};\n```\n\n### **Filtered Calendar API**\n```python\n# GET /api/savings-groups/calendar/events/?gender=F&start_date=2024-12-01\n@authenticate\ndef get_calendar_events():\n    query = CalendarEvent.query\n    \n    # Filter by date range\n    if request.args.get('start_date'):\n        query = query.filter(CalendarEvent.date >= request.args.get('start_date'))\n    \n    # Filter by gender\n    if request.args.get('gender') and request.args.get('gender') != 'ALL':\n        query = query.join(GroupMember, CalendarEvent.user_id == GroupMember.user_id)\\\n                    .filter(GroupMember.gender == request.args.get('gender'))\n    \n    # Filter by event types\n    if request.args.get('event_types'):\n        types = request.args.get('event_types').split(',')\n        query = query.filter(CalendarEvent.event_type.in_(types))\n    \n    events = query.all()\n    return jsonify({'events': [event.to_dict() for event in events]})\n```\n\n---\n\n## 📊 **Real-Time Gender Analytics**\n\n### **Activity Tracking by Gender**\n```javascript\n// When Sarah (Female) records savings, analytics update automatically\n\n// Before Sarah's transaction:\n{\n  \"daily_stats\": {\n    \"2024-12-08\": {\n      \"women\": { \"transactions\": 2, \"amount\": 75000 },\n      \"men\": { \"transactions\": 0, \"amount\": 0 }\n    }\n  }\n}\n\n// After Sarah's UGX 50,000 transaction:\n{\n  \"daily_stats\": {\n    \"2024-12-08\": {\n      \"women\": { \"transactions\": 3, \"amount\": 125000 },  // Updated\n      \"men\": { \"transactions\": 0, \"amount\": 0 }\n    }\n  }\n}\n```\n\n### **Calendar Event with Gender Context**\n```javascript\n// When user clicks on Sarah's transaction event\nconst eventDetails = {\n  \"basic_info\": {\n    \"title\": \"Sarah Nakato - Personal Savings\",\n    \"date\": \"December 8, 2024\",\n    \"time\": \"2:30 PM\",\n    \"amount\": \"UGX 50,000\"\n  },\n  \"member_context\": {\n    \"name\": \"Sarah Nakato\",\n    \"gender\": \"Female\",\n    \"role\": \"Chair\",\n    \"group\": \"Kampala Women's Cooperative\"\n  },\n  \"gender_impact\": {\n    \"contribution_to_women_total\": \"3.0%\",\n    \"women_vs_men_today\": \"Women: UGX 125,000 (100%), Men: UGX 0 (0%)\",\n    \"group_gender_distribution\": \"100% women-led group\"\n  },\n  \"related_activities\": [\n    \"Previous savings: UGX 25,000 (Dec 1)\",\n    \"Meeting attendance: 95% this month\",\n    \"Leadership role: Active chair since Jan 2024\"\n  ]\n};\n```\n\n---\n\n## 🎯 **User Experience Examples**\n\n### **Scenario 1: Group Officer View (Sarah - Female Chair)**\n```javascript\n// Sarah logs in and sees her calendar\n// Default view: All activities in her group\n\nconst sarahsCalendarView = {\n  \"filter_applied\": \"My Group Activities\",\n  \"visible_events\": [\n    \"💰 Mary Nambi (F) - ECD Fund: UGX 25,000\",\n    \"👥 Weekly Meeting - 5 women attended\",\n    \"💰 Alice Ssali (F) - Personal Savings: UGX 30,000\",\n    \"🏦 Jane Nakirya (F) - Loan Application: UGX 200,000\"\n  ],\n  \"gender_summary\": {\n    \"total_activities\": 15,\n    \"women_activities\": 15,\n    \"men_activities\": 0,\n    \"note\": \"100% women-led group activities\"\n  }\n};\n\n// Sarah can filter to see:\n// - Only her personal activities\n// - Only women's activities (same as all, since 100% women)\n// - Only transaction events\n// - Specific date ranges\n```\n\n### **Scenario 2: Admin View (Cross-Group Analysis)**\n```javascript\n// Admin sees system-wide calendar with gender filtering\n\nconst adminCalendarView = {\n  \"filter_applied\": \"All Groups - Women Only\",\n  \"visible_events\": [\n    \"💰 Sarah Nakato (F) - Kampala Women's: UGX 50,000\",\n    \"💰 Mary Nambi (F) - Kampala Women's: UGX 25,000\",\n    \"💰 Rose Namuli (F) - Nakasero Traders: UGX 40,000\",\n    \"👥 Women's Leadership Meeting - 3 groups\"\n  ],\n  \"gender_insights\": {\n    \"women_total_today\": \"UGX 115,000\",\n    \"women_vs_men_ratio\": \"78% women, 22% men\",\n    \"most_active_gender\": \"Women (12 activities vs 3 men)\"\n  }\n};\n\n// Admin can switch to \"Men Only\" filter:\nconst menOnlyView = {\n  \"visible_events\": [\n    \"💰 John Mukasa (M) - Nakasero Traders: UGX 35,000\",\n    \"🏦 Peter Ssali (M) - Loan Repayment: UGX 15,000\"\n  ],\n  \"insights\": \"Men represent 25% of membership but 22% of financial activity\"\n};\n```\n\n---\n\n## 🔧 **Technical Implementation**\n\n### **Automatic Event Creation**\n```python\n# Decorator to automatically create calendar events\ndef create_calendar_event(event_type, event_subtype):\n    def decorator(f):\n        @wraps(f)\n        def decorated_function(*args, **kwargs):\n            # Execute the original function\n            result = f(*args, **kwargs)\n            \n            # Get current user and member context\n            current_user = get_current_user()\n            member = GroupMember.query.filter_by(user_id=current_user.id).first()\n            \n            # Create calendar event automatically\n            event = CalendarEvent(\n                event_type=event_type,\n                event_subtype=event_subtype,\n                date=datetime.now().date(),\n                time=datetime.now().time(),\n                group_id=member.group_id,\n                user_id=current_user.id,\n                event_data={\n                    'member_gender': member.gender,\n                    'member_role': member.role,\n                    'member_name': member.name\n                }\n            )\n            \n            db.session.add(event)\n            db.session.commit()\n            \n            return result\n        return decorated_function\n    return decorator\n\n# Usage:\n@create_calendar_event('TRANSACTION', 'savings_deposit')\ndef record_saving():\n    # Function automatically creates calendar event\n    pass\n```\n\n### **Gender-Aware Calendar Queries**\n```python\n# Optimized queries for gender filtering\nclass CalendarService:\n    @staticmethod\n    def get_events_by_gender(group_id=None, gender=None, date_range=None):\n        query = db.session.query(\n            CalendarEvent,\n            GroupMember.gender,\n            GroupMember.name,\n            GroupMember.role\n        ).join(\n            GroupMember, \n            CalendarEvent.user_id == GroupMember.user_id\n        )\n        \n        if group_id:\n            query = query.filter(CalendarEvent.group_id == group_id)\n        \n        if gender and gender != 'ALL':\n            query = query.filter(GroupMember.gender == gender)\n        \n        if date_range:\n            query = query.filter(\n                CalendarEvent.date.between(\n                    date_range['start'], \n                    date_range['end']\n                )\n            )\n        \n        return query.all()\n```\n\n---\n\n## ✅ **Complete Integration Benefits**\n\n### **For Users**\n- **Automatic Tracking**: Every activity automatically appears on calendar\n- **Personal History**: See their own activity timeline\n- **Gender Context**: Understand their contribution in gender context\n- **Interactive Details**: Click any event for full information\n\n### **For Group Officers**\n- **Member Oversight**: See all member activities with gender breakdown\n- **Gender Analytics**: Track women vs men participation\n- **Activity Patterns**: Identify trends by gender and time\n- **Verification Workflow**: Process transactions with full context\n\n### **For Administrators**\n- **System-Wide View**: All activities across groups with gender filtering\n- **Gender Equity Monitoring**: Track gender participation and inclusion\n- **Comparative Analysis**: Compare gender metrics across groups\n- **Impact Reporting**: Generate gender-disaggregated reports\n\n**This creates a seamless flow where every user activity automatically becomes a calendar event with full gender context for analytics and filtering!**"